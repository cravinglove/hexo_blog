---
title: 计算机网络网络层
date: 2018/05/05 00:46:25
categories:
- 计算机网络
tags:
- 计算机网络
---

# 网络层

## 概念

1. 虚电路：一条逻辑上的连接，分组都沿着这条逻辑连接按照存储转发的方式传送，而不是真正建立了一条物理连接。
2. IP（网际协议）:TCP/IP体系中两个最主要的协议之一，也是最重要的互联网标准之一，与ARP、ICMP、IGMP配套使用。
3. ARP：地址解析协议，用于从IP地址到MAC地址的转换
4. ICMP:网际控制报文协议，允许主机或路由器报告差错情况和有关异常情况的报告。
5. 子网掩码:子网掩码用于确定关于子网划分的信息，并标识IP地址中的网络部分和主机部分。
6. CIDR:称为无分类域间路由选择，使用斜线记法标明前缀和主机号，网络前缀代替了网络号和子网号。
<!-- more -->
7. 默认路由：路由表中无法查找到目的地址的路由信息，路由器选择的路由。
8. 路由选择算法：
9. 自治系统AS:在单一技术管理下的一组路由器，使用统一的路由选择协议和共同的度量。对其他AS表现出单一和一致的路由选择策略。
10. IGP（内部网关协议）：一个自治系统内部使用的路由选择协议，与其他自治系统使用什么路由选择协议无关，常用RIP和OSPF协议。
11. EGP(外部网关协议):简言之就是自治系统之间使用的路由选择协议，比如常用的BGP的第四个版本BGP-4。
12. RIP协议:是一种分布式的基于距离向量的路由选择协议，是互联网的标准协议，最大优点是简单。维护自己到其他每一个目的网络的距离记录，这是一组距离，即距离向量。
13. OSPF（开放最短路径优先）协议：最主要的特征是使用分布式的链路状态协议，而不是像RIP一样的距离向量协议。
14. BGP（边界网关协议）:在不同自治系统交换路由信息的协议。
15. IPV6:下一代网际协议，IP协议的另一个版本。





## 问答

### 网络层的任务

网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务。

### 网络层有那两类服务？各有何优缺点？因特网采纳了何种服务

- 虚电路服务和数据报服务。
- 虚电路服务优点是减少了分组的开销，若使用可靠传输的网络协议，就可以使得分组无差错按需到达终点；缺点是网络造价高并且不太灵活，所有数据都按相同的路由发送，中间某结点发生故障就导致整个线路中断，数据无法继续发送。
- 数据报服务优点是造价大大降低，运行方式灵活，可适应多种应用；缺点是发送的分组可能出错丢失重复和失序等，不保证交付的时限。
- 因特网采用数据报服务。

### IP协议的用途，IP是否提供可靠的网络通讯。

当互连在一起的计算机网络都是用相同的IP协议时，就可以使得性能各异的网络在网络层看起来好像是一个统一的网络。
不提供可靠的网络通讯，提供尽最大努力交付数据报服务。

### IP地址的编址方法有那三类？

三个历史阶段

1. 分类的IP地址：最基本的编址方法
2. 子网的划分：对最基本的编址方法的改进
3. 构成超网：比较新的无分类编址方法

### 三种编址模式下，IP地址的格式特点。

1）分类的IP地址：两级地址。IP地址::={ <网络号>, <主机号>} 
2）子网的划分：三级地址。IP地址::= {<网络号>, <子网号>, <主机号>} 
3）构成超网：无分类两级地址。IP地址::= {<网络前缀>, <主机号>}

### 会正确计算三种编址方法下，一个IP网络的有效地址范围。

具体做法可以看书上例题，需要注意的是全0和全1的主机无效。

### 掌握三种编址方法下，路由器的分组转发的流程。

分类的IP地址：(1) 从数据报的首部提取目的主机的IP地址D, 得出目的网络地址为N。
(2) 若网络N 与此路由器直接相连，则把数据报直接交付目的主机D；否则是间接交付，执行(3)。
(3) 若路由表中有目的地址为D 的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行(4)。
(4) 若路由表中有到达网络N的路由，则把数据报传送给路由表指明的下一跳路由器；否则，执行(5)。
(5) 若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由器；否则，执行(6)。
(6) 报告转发分组出错。

划分子网时：
(1) 从收到的分组的首部提取目的IP地址D。
(2) 先用各网络的子网掩码和D 逐位相“与”，看是否和相应的网络地址匹配。若匹配，则将分组直接交付。否则就是间接交付，执行(3)。
(3) 若路由表中有目的地址为D的特定主机路由，则将 分组传送给指明的下一跳路由器；否则，执行(4)。
(4) 对路由表中的每一行的子网掩码和D逐位相“与”， 若其结果N与该行的目的网络地址匹配，则将分组传送给该行指明的下一跳路由器；否则，执行(5)。
(5) 若路由表中有一个默认路由，则将分组传送给路由表中所指明的默认路由器；否则，执行(6)。
(6) 报告转发分组出错。

构成超网时：仍采用分组转发算法，只是在查找路由表时使用最长前缀匹配或二叉线索法。

### ARP的工作原理，路由器是如何确定下一站的物理地址的？

- **工作原理**：每一个主机都设有一个ARP高速缓存(ARP cache)，里面有所在的局域网上的各主机和路由器的IP地址到硬件地址的映射表。当主机A欲向本局域网上的某个主机B发送IP数据报时，就先在其ARP高速缓存中查看有无主机B的IP地址。如有，就可查出其对应的硬件地址，再将此硬件地址写入MAC帧，然后通过局域网将该MAC帧发往此硬件地址。当路由器或主机查不到B的IP地址时，A就自动运行ARP，ARP进程通过在本局域网上发送ARP请求分组广播并接收B返回的ARP响应分组，再在A的ARP高速缓存中写入B的IP地址到硬件地址的映射（此时B也会在自己的ARP高速缓存中写入A的地址映射）。另外，高速缓存中的每一个映射项目都设置有生存时间。
- **路由器确定物理地址**：路由器收到某主机发送过来的IP数据报后，就从转发表中找出下一跳的路由器，同时使用ARP解析出下一跳路由器的硬件地址，也就是下一站的物理地址。

### IP数据报的格式。IP分段（或分片）与重组。分片与重组发生的位置？

![IP数据报](https://github.com/CyC2018/Interview-Notebook/blob/master/pics/85c05fb1-5546-4c50-9221-21f231cdc8c5.jpg)
一个IP数据报由首部和数据两部分组成。首部的前一部分是固定长度，共20 字节，是所有IP 数据报必须具有的。在首部的固定部分的后面是一些可选字段，其长度是可变的。

当数据报的长度超过网络所允许的最大传送单元MTU时，需对数据报进行分片后再传输，每个分片的长度是8字节的整数倍。

分片的位置通过片偏移来体现，表现了某片在原分组的相对位置。

### RIP中“距离”的含义是什么？RIP的工作原理。

- **距离**：RIP中对距离的定义是从一路由器到直接相连的网络的距离定义为1，到非直接相连的网络的距离定义为经过的路由器数加一。

- **原理**：路由器在刚开始工作时，路由表是空的，然后路由器就得出到直接相连的几个网络的距离。接着每一个路由器也只和数目非常有限的相邻路由器交换并更新路由信息。但经过若干次更新后，所有的路由器最终都会知道到达本自治系统中任何一个网络的最短距离和下一跳的路由器的地址。

### OSPF中“链路状态”的含义是什么。OSPF的工作原理。

- **链路状态**：所谓链路状态就是说明本路由器都和哪些路由器相邻，以及该链路的度量（metric），度量也可以理解为代价。

### 路由器的结构及工作原理。

结构上划分为路由选择部分和分组转发部分。

### 什么是自治系统AS？域内路由选择与域间路由选择有何应用区别？给有哪些代表协议？

- **AS**:自治系统是在单一技术管理下的一组路由器，这些路由器使用一种自治系统内部的路由选择协议和共同的度量。

- **区别**：域内路由选择是在自治系统内部的路由选择，与互联网其他自治系统使用什么路由选择协议无关，常用RIP和OSPF协议；域间路由选择是自治系统之间的路由选择，当源主机和目的主机不在同一个自治系统时，当数据报传送到一个自治系统的边界时，就需要使用一种协议将路由选择信息传递到另一个自治系统中，常用BGP协议。

### 路由选择协议与路由转发策略是否是一回事？路由器中路由表与转发表的区别？

- 路由选择协议解决的是如何获得路由表中的路由信息，指的是路由选择策略,路由选择涉及多个路由器。
路由转发策略指路由器根据转发表将用户的 IP 数据报从合适的端口转发出去,涉及一个路由器。

- 区别：1）路由表一般包含从目的地址到下一跳的映射；转发表必须包含完成转发功能的所必需的信息。
2）路由表是根据路由选择算法得出的。而转发表是从路由表得出的。
3）路由表和转发表应采用不同的数据结构。路由表需要对网络拓扑变化的计算最优化，而转发表应当使得查找过程最优化。
4）路由表总是通过软件来实现，而转发表可用特殊的硬件实现。

****
2018 年 5月 5日